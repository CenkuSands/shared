#!/bin/bash

# Kafka bootstrap server
BOOTSTRAP_SERVER="localhost:9092"

# Get the list of all topics
TOPICS=$(kafka-topics.sh --bootstrap-server $BOOTSTRAP_SERVER --list)

# Iterate over each topic
for TOPIC in $TOPICS
do
  echo "Topic: $TOPIC"
  
  # Fetch the log directory information for each topic
  LOG_DIR_INFO=$(kafka-log-dirs.sh --bootstrap-server $BOOTSTRAP_SERVER --describe --topic-list $TOPIC)

  # Extract partition and high watermark offset information
  echo "$LOG_DIR_INFO" | grep -E 'Partition:|Offset:' | while read -r line1; read -r line2
  do
    PARTITION=$(echo $line1 | awk '{print $2}')
    OFFSET=$(echo $line2 | awk '{print $3}')

    # Convert the high watermark offset time to human-readable format (if it represents a timestamp)
    LAST_MODIFIED_HUMAN=$(date -d @$((OFFSET/1000)) +"%Y-%m-%d %H:%M:%S")

    echo "Partition: $PARTITION - Last Modified: $LAST_MODIFIED_HUMAN"
  done

  echo ""
done


Querying brokers for log directories information
Received log directory information from brokers 1,2,3
{"version":1,"brokers":[{"broker":1,"logDirs":[{"logDir":"/data","error":null,"partitions":[{"partition":"CDC.QA.G.PatronSession-0","size":7687,"offsetLag":0,"isFuture":false}]}]},{"broker":2,"logDirs":[{"logDir":"/data","error":null,"partitions":[{"partition":"CDC.QA.G.PatronSession-0","size":7687,"offsetLag":0,"isFuture":false}]}]},{"broker":3,"logDirs":[{"logDir":"/data","error":null,"partitions":[{"partition":"CDC.QA.G.PatronSession-0","size":7687,"offsetLag":0,"isFuture":false}]}]}]}
