#!/bin/bash

# Set Kafka home directory and topic name
KAFKA_HOME="/path/to/kafka"
TOPIC="your_topic"
LOG_DIR="/path/to/kafka/logs"

# Function to extract the last offset timestamp from a log segment file
get_last_offset_timestamp() {
    local log_file=$1
    echo "Processing log file: $log_file"

    # Use kafka-dump-log.sh to find the last record's offset and timestamp
    $KAFKA_HOME/bin/kafka-dump-log.sh --files $log_file --print-data-log --deep-iteration | \
    awk 'BEGIN {last_offset=""; last_timestamp=""}
         /offset:/{last_offset=$2}
         /CreateTime:/{last_timestamp=$2}
         END {print "Last Offset:", last_offset, "Timestamp:", last_timestamp}'
}

# Iterate over all partitions in the topic
for partition_dir in $LOG_DIR/$TOPIC-*; do
    # Get the latest log segment file for the partition
    latest_log_file=$(ls -t $partition_dir/*.log | head -1)
    
    if [ -n "$latest_log_file" ]; then
        get_last_offset_timestamp $latest_log_file
    else
        echo "No log files found for partition $partition_dir"
    fi
done
